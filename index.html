<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工程单位换算器</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 使用 Inter 字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
        }
        /* 自定义下拉箭头 */
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            padding-right: 2.5rem;
        }
        /* 移除数字输入框的箭头 (Chrome, Safari, Edge, Opera) */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* 移除数字输入框的箭头 (Firefox) */
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-2xl bg-white rounded-xl shadow-2xl p-6 md:p-8">
        <h1 id="mainTitle" class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-6">
            工程单位换算器
        </h1>
        
        <!-- 单位类别选择 -->
        <div class="mb-5">
            <label id="categoryLabel" for="categorySelect" class="block text-sm font-medium text-gray-700 mb-2">选择换算类别：</label>
            <select id="categorySelect" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg text-gray-900 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                <!-- 类别将由JS动态填充 -->
            </select>
        </div>

        <!-- 换算区域 -->
        <div class="grid grid-cols-1 md:grid-cols-11 gap-4 items-center">
            
            <!-- "从" (From) -->
            <div class="md:col-span-5 flex flex-col">
                <label id="inputLabel" for="inputValue" class="text-sm font-medium text-gray-700 mb-2">输入数值：</label>
                <input type="number" id="inputValue" placeholder="0" class="w-full p-3 text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                <select id="fromUnitSelect" class="w-full p-3 mt-3 bg-gray-50 border border-gray-300 rounded-lg text-gray-900 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    <!-- 单位将由JS动态填充 -->
                </select>
            </div>

            <!-- 箭头/等于号 (Swap Button) -->
            <div class="md:col-span-1 flex justify-center items-center h-full pt-10 md:pt-8">
                <!-- 按钮在 'constants' 类别下会隐藏 -->
                <button id="swapButton" title="Swap units" class="p-2 rounded-full text-blue-600 hover:bg-blue-100 transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-300">
                    <!-- Desktop (horizontal) swap icon -->
                    <svg class="h-8 w-8 hidden md:block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m4 6H4m0 0l4 4m-4-4l4-4" />
                    </svg>
                    <!-- Mobile (vertical) swap icon -->
                    <svg class="h-6 w-6 md:hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                         <path stroke-linecap="round" stroke-linejoin="round" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                    </svg>
                </button>
            </div>

            <!-- "至" (To) -->
            <div class="md:col-span-5 flex flex-col">
                <label id="resultLabel" for="resultValue" class="text-sm font-medium text-gray-700 mb-2">换算结果：</label>
                <div id="resultValue" class="w-full p-3 text-lg bg-gray-100 rounded-lg min-h-[50px] flex items-center border border-gray-200 text-gray-800 font-medium break-all">
                    -
                </div>
                <!-- 下拉框在 'constants' 类别下会隐藏 -->
                <select id="toUnitSelect" class="w-full p-3 mt-3 bg-gray-50 border border-gray-300 rounded-lg text-gray-900 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    <!-- 单位将由JS动态填充 -->
                </select>
            </div>
        </div>

        <!-- 版本号、编者与语言切换 -->
        <div class="mt-6 pt-4 border-t border-gray-200 flex justify-between items-center text-sm text-gray-500">
            <div class="text-xs">
                <div>
                    <span id="versionLabel">版本</span>: <span id="versionNumber">1.3.3</span>
                </div>
                <div>
                    <span id="authorLabel">编者</span>: 荆炎荣
                </div>
            </div>
            <button id="langToggleButton" class="px-3 py-1 rounded-md bg-gray-100 hover:bg-gray-200 text-blue-600 font-medium transition-colors">
                English
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            let currentLang = 'zh';
            const version = '1.3.3'; // 版本升级

            // --- 1. 翻译文本 ---
            const translations = {
                zh: {
                    title: '工程单位换算器',
                    category: '选择换算类别：',
                    input: '输入数值：',
                    result: '换算结果：',
                    selectConstant: '选择常数：', 
                    constantValue: '常数值：', 
                    langToggle: 'English',
                    version: '版本',
                    author: '编者' 
                },
                en: {
                    title: 'Engineering Unit Converter',
                    category: 'Select Category:',
                    input: 'Input Value:',
                    result: 'Result:',
                    selectConstant: 'Select Constant:', 
                    constantValue: 'Constant Value:', 
                    langToggle: '中文',
                    version: 'Version',
                    author: 'Editor' 
                }
            };

            // --- 2. 单位定义 (支持中英文) ---
            const units = {
                temperature: {
                    name: { zh: '温度', en: 'Temperature' },
                    baseUnit: 'celsius',
                    list: {
                        celsius: { name: { zh: '摄氏度 (°C)', en: 'Celsius (°C)' } },
                        fahrenheit: { name: { zh: '华氏度 (°F)', en: 'Fahrenheit (°F)' } },
                        kelvin: { name: { zh: '开尔文 (K)', en: 'Kelvin (K)' } },
                    }
                },
                pressure: {
                    name: { zh: '压力 (制冷常用)', en: 'Pressure (HVAC/R)' },
                    baseUnit: 'pascal',
                    list: {
                        pascal: { name: { zh: '帕斯卡 (Pa)', en: 'Pascal (Pa)' }, factor: 1 },
                        kilopascal: { name: { zh: '千帕 (kPa)', en: 'Kilopascal (kPa)' }, factor: 1000 },
                        megapascal: { name: { zh: '兆帕 (MPa)', en: 'Megapascal (MPa)' }, factor: 1000000 },
                        bar: { name: { zh: '巴 (bar)', en: 'Bar (bar)' }, factor: 100000 },
                        mbar: { name: { zh: '毫巴 (mbar)', en: 'Millibar (mbar)' }, factor: 100 },
                        psi: { name: { zh: '磅/平方英寸 (psi)', en: 'Pounds/sq inch (psi)' }, factor: 6894.757 },
                        atm: { name: { zh: '标准大气压 (atm)', en: 'Atmosphere (atm)' }, factor: 101325 },
                        mmHg: { name: { zh: '毫米汞柱 (mmHg)', en: 'Millimeter of mercury (mmHg)' }, factor: 133.322 },
                        inHg: { name: { zh: '英寸汞柱 (inHg)', en: 'Inch of mercury (inHg)' }, factor: 3386.389 },
                        kgf_cm2: { name: { zh: '公斤力/平方厘米 (kgf/cm²)', en: 'Kilogram-force/sq cm (kgf/cm²)' }, factor: 98066.5 },
                    }
                },
                power: {
                    name: { zh: '功率 (制冷量)', en: 'Power (Refrigeration)' },
                    baseUnit: 'watt',
                    list: {
                        watt: { name: { zh: '瓦 (W)', en: 'Watt (W)' }, factor: 1 },
                        kilowatt: { name: { zh: '千瓦 (kW)', en: 'Kilowatt (kW)' }, factor: 1000 },
                        megawatt: { name: { zh: '兆瓦 (MW)', en: 'Megawatt (MW)' }, factor: 1000000 },
                        gigawatt: { name: { zh: '吉瓦 (GW)', en: 'Gigawatt (GW)' }, factor: 1000000000 },
                        terawatt: { name: { zh: '太瓦 (TW)', en: 'Terawatt (TW)' }, factor: 1000000000000 },
                        'btu_hr': { name: { zh: '英热单位/小时 (BTU/hr)', en: 'BTU/hour (BTU/hr)' }, factor: 0.293071 },
                        'ton_refrigeration': { name: { zh: '美制冷吨 (TR)', en: 'US Ton (TR)' }, factor: 3516.853 },
                        'kcal_hr': { name: { zh: '千卡/小时 (kcal/h)', en: 'Kilocalorie/hour (kcal/h)' }, factor: 1.163 },
                        'hp': { name: { zh: '马力 (HP, 电机)', en: 'Horsepower (HP, electric)' }, factor: 745.7 }
                    }
                },
                energy: {
                    name: { zh: '能量 (热值)', en: 'Energy (Heating)' },
                    baseUnit: 'joule',
                    list: {
                        'joule': { name: { zh: '焦耳 (J)', en: 'Joule (J)' }, factor: 1 },
                        'kilojoule': { name: { zh: '千焦 (kJ)', en: 'Kilojoule (kJ)' }, factor: 1000 },
                        'megajoule': { name: { zh: '兆焦 (MJ)', en: 'Megajoule (MJ)' }, factor: 1000000 },
                        'gigajoule': { name: { zh: '吉焦 (GJ)', en: 'Gigajoule (GJ)' }, factor: 1000000000 },
                        'terajoule': { name: { zh: '太焦 (TJ)', en: 'Terajoule (TJ)' }, factor: 1000000000000 },
                        'kwh': { name: { zh: '千瓦时 (kW·h)', en: 'Kilowatt-hour (kW·h)' }, factor: 3600000 },
                        'calorie': { name: { zh: '卡 (cal)', en: 'Calorie (cal)' }, factor: 4.184 },
                        'kilocalorie': { name: { zh: '千卡 (kcal)', en: 'Kilocalorie (kcal)' }, factor: 4184 },
                        'btu': { name: { zh: '英热单位 (BTU)', en: 'British Thermal Unit (BTU)' }, factor: 1055.056 },
                    }
                },
                volumetric_flow: {
                    name: { zh: '体积流量 (风量/水流量)', en: 'Volumetric Flow (Air/Water)' },
                    baseUnit: 'm3/s',
                    list: {
                        'm3_s': { name: { zh: '立方米/秒 (m³/s)', en: 'Cubic meter/second (m³/s)' }, factor: 1 },
                        'm3_hr': { name: { zh: '立方米/小时 (m³/h)', en: 'Cubic meter/hour (m³/h)' }, factor: 1 / 3600 },
                        'L_s': { name: { zh: '升/秒 (L/s)', en: 'Liter/second (L/s)' }, factor: 0.001 },
                        'L_min': { name: { zh: '升/分钟 (L/min)', en: 'Liter/minute (L/min)' }, factor: 0.001 / 60 },
                        'cfm': { name: { zh: '立方英尺/分钟 (CFM)', en: 'Cubic feet/minute (CFM)' }, factor: 0.000471947 },
                        'gpm_us': { name: { zh: '美制加仑/分钟 (US GPM)', en: 'US Gallon/minute (US GPM)' }, factor: 0.00378541 / 60 },
                    }
                },
                mass_flow: {
                    name: { zh: '质量流量', en: 'Mass Flow' },
                    baseUnit: 'kg/s',
                    list: {
                        'kg_s': { name: { zh: '千克/秒 (kg/s)', en: 'Kilogram/second (kg/s)' }, factor: 1 },
                        'kg_hr': { name: { zh: '千克/小时 (kg/h)', en: 'Kilogram/hour (kg/h)' }, factor: 1 / 3600 },
                        'ton_hr': { name: { zh: '吨/小时 (t/h, 公制)', en: 'Tonne/hour (t/h, metric)' }, factor: 1000 / 3600 },
                        'lb_s': { name: { zh: '磅/秒 (lb/s)', en: 'Pound/second (lb/s)' }, factor: 0.45359237 },
                        'lb_min': { name: { zh: '磅/分钟 (lb/min)', en: 'Pound/minute (lb/min)' }, factor: 0.45359237 / 60 },
                        'lb_hr': { name: { zh: '磅/小时 (lb/hr)', en: 'Pound/hour (lb/hr)' }, factor: 0.45359237 / 3600 },
                    }
                },
                density: {
                    name: { zh: '密度', en: 'Density' },
                    baseUnit: 'kg/m3',
                    list: {
                        'kg_m3': { name: { zh: '千克/立方米 (kg/m³)', en: 'Kilogram/cubic meter (kg/m³)' }, factor: 1 },
                        'g_cm3': { name: { zh: '克/立方厘米 (g/cm³)', en: 'Gram/cubic centimeter (g/cm³)' }, factor: 1000 },
                        'g_L': { name: { zh: '克/升 (g/L)', en: 'Gram/liter (g/L)' }, factor: 1 },
                        'lb_ft3': { name: { zh: '磅/立方英尺 (lb/ft³)', en: 'Pound/cubic foot (lb/ft³)' }, factor: 16.01846 },
                        'lb_gal_us': { name: { zh: '磅/美制加仑 (lb/gal)', en: 'Pound/US gallon (lb/gal)' }, factor: 119.8264 },
                    }
                },
                specific_heat: {
                    name: { zh: '比热容', en: 'Specific Heat' },
                    baseUnit: 'J/(kg·K)',
                    list: {
                        'J_kgK': { name: { zh: '焦耳/千克·开尔文 (J/(kg·K))', en: 'Joule/kilogram·kelvin (J/(kg·K))' }, factor: 1 },
                        'kJ_kgK': { name: { zh: '千焦/千克·开尔文 (kJ/(kg·K))', en: 'Kilojoule/kilogram·kelvin (kJ/(kg·K))' }, factor: 1000 },
                        'kcal_kg_C': { name: { zh: '千卡/千克·°C (kcal/(kg·°C))', en: 'Kilocalorie/kilogram·°C (kcal/(kg·°C))' }, factor: 4186.8 },
                        'btu_lb_F': { name: { zh: 'BTU/(lb·°F)', en: 'BTU/(lb·°F)' }, factor: 4186.8 },
                    }
                },
                thermal_conductivity: {
                    name: { zh: '导热系数', en: 'Thermal Conductivity' },
                    baseUnit: 'W/(m·K)',
                    list: {
                        'W_mK': { name: { zh: '瓦/米·开尔文 (W/(m·K))', en: 'Watt/meter·kelvin (W/(m·K))' }, factor: 1 },
                        'kcal_hr_m_C': { name: { zh: '千卡/(hr·m·°C)', en: 'Kilocalorie/(hr·m·°C)' }, factor: 1.163 },
                        'btu_hr_ft_F': { name: { zh: 'BTU/(hr·ft·°F)', en: 'BTU/(hr·ft·°F)' }, factor: 1.730735 },
                    }
                },
                dynamic_viscosity: {
                    name: { zh: '动力粘度', en: 'Dynamic Viscosity' },
                    baseUnit: 'pa_s',
                    list: {
                        'pa_s': { name: { zh: '帕斯卡·秒 (Pa·s)', en: 'Pascal-second (Pa·s)' }, factor: 1 },
                        'poise': { name: { zh: '泊 (P)', en: 'Poise (P)' }, factor: 0.1 },
                        'centipoise': { name: { zh: '厘泊 (cP)', en: 'Centipoise (cP)' }, factor: 0.001 },
                        'lb_ft_s': { name: { zh: '磅/(英尺·秒) (lb/(ft·s))', en: 'Pound/(foot·second) (lb/(ft·s))' }, factor: 1.48816 },
                    }
                },
                kinematic_viscosity: {
                    name: { zh: '运动粘度', en: 'Kinematic Viscosity' },
                    baseUnit: 'm2/s',
                    list: {
                        'm2_s': { name: { zh: '米²/秒 (m²/s)', en: 'Meter²/second (m²/s)' }, factor: 1 },
                        'stokes': { name: { zh: '斯 (St)', en: 'Stokes (St)' }, factor: 0.0001 },
                        'centistokes': { name: { zh: '厘斯 (cSt)', en: 'Centistokes (cSt)' }, factor: 0.000001 },
                        'ft2_s': { name: { zh: '英尺²/秒 (ft²/s)', en: 'Foot²/second (ft²/s)' }, factor: 0.09290304 },
                    }
                },
                speed: {
                    name: { zh: '速度', en: 'Speed' },
                    baseUnit: 'm/s',
                    list: {
                        'm_s': { name: { zh: '米/秒 (m/s)', en: 'Meter/second (m/s)' }, factor: 1 },
                        'km_h': { name: { zh: '千米/小时 (km/h)', en: 'Kilometer/hour (km/h)' }, factor: 1000 / 3600 },
                        'ft_s': { name: { zh: '英尺/秒 (ft/s)', en: 'Foot/second (ft/s)' }, factor: 0.3048 },
                        'mph': { name: { zh: '英里/小时 (mph)', en: 'Miles/hour (mph)' }, factor: 1609.344 / 3600 },
                        'knot': { name: { zh: '节 (knot)', en: 'Knot (knot)' }, factor: 1852 / 3600 },
                    }
                },
                acceleration: {
                    name: { zh: '加速度', en: 'Acceleration' },
                    baseUnit: 'm/s2',
                    list: {
                        'm_s2': { name: { zh: '米/秒² (m/s²)', en: 'Meter/second² (m/s²)' }, factor: 1 },
                        'km_h_s': { name: { zh: '千米/小时/秒 (km/h/s)', en: 'Kilometer/hour/second (km/h/s)' }, factor: 1000 / 3600 },
                        'ft_s2': { name: { zh: '英尺/秒² (ft/s²)', en: 'Foot/second² (ft/s²)' }, factor: 0.3048 },
                        'g': { name: { zh: '标准重力 (g)', en: 'Standard gravity (g)' }, factor: 9.80665 },
                    }
                },
                length: {
                    name: { zh: '长度', en: 'Length' },
                    baseUnit: 'meter',
                    list: {
                        kilometer: { name: { zh: '千米 (km)', en: 'Kilometer (km)' }, factor: 1000 },
                        meter: { name: { zh: '米 (m)', en: 'Meter (m)' }, factor: 1 },
                        centimeter: { name: { zh: '厘米 (cm)', en: 'Centimeter (cm)' }, factor: 0.01 },
                        millimeter: { name: { zh: '毫米 (mm)', en: 'Millimeter (mm)' }, factor: 0.001 },
                        si: { name: { zh: '丝 (sī, 0.01mm)', en: 'Si (0.01mm)' }, factor: 1e-5 }, // 新增
                        micrometer: { name: { zh: '微米 (μm)', en: 'Micrometer (μm)' }, factor: 1e-6 }, // 新增
                        nanometer: { name: { zh: '纳米 (nm)', en: 'Nanometer (nm)' }, factor: 1e-9 }, // 新增
                        mile: { name: { zh: '英里 (mi)', en: 'Mile (mi)' }, factor: 1609.344 },
                        nautical_mile: { name: { zh: '海里 (nmi)', en: 'Nautical Mile (nmi)' }, factor: 1852 },
                        yard: { name: { zh: '码 (yd)', en: 'Yard (yd)' }, factor: 0.9144 },
                        foot: { name: { zh: '英尺 (ft)', en: 'Foot (ft)' }, factor: 0.3048 },
                        inch: { name: { zh: '英寸 (in)', en: 'Inch (in)' }, factor: 0.0254 }
                    }
                },
                mass: {
                    name: { zh: '质量', en: 'Mass' },
                    baseUnit: 'kilogram',
                    list: {
                        kilogram: { name: { zh: '千克 (kg)', en: 'Kilogram (kg)' }, factor: 1 },
                        gram: { name: { zh: '克 (g)', en: 'Gram (g)' }, factor: 0.001 },
                        milligram: { name: { zh: '毫克 (mg)', en: 'Milligram (mg)' }, factor: 0.000001 },
                        pound: { name: { zh: '磅 (lb)', en: 'Pound (lb)' }, factor: 0.45359237 },
                        ounce: { name: { zh: '盎司 (oz)', en: 'Ounce (oz)' }, factor: 0.02834952 },
                    }
                },
                area: {
                    name: { zh: '面积', en: 'Area' },
                    baseUnit: 'sq_meter',
                    list: {
                        sq_meter: { name: { zh: '平方米 (m²)', en: 'Square meter (m²)' }, factor: 1 },
                        sq_centimeter: { name: { zh: '平方厘米 (cm²)', en: 'Square centimeter (cm²)' }, factor: 0.0001 },
                        sq_kilometer: { name: { zh: '平方千米 (km²)', en: 'Square kilometer (km²)' }, factor: 1000000 },
                        sq_foot: { name: { zh: '平方英尺 (ft²)', en: 'Square foot (ft²)' }, factor: 0.09290304 },
                        sq_inch: { name: { zh: '平方英寸 (in²)', en: 'Square inch (in²)' }, factor: 0.00064516 },
                        acre: { name: { zh: '英亩 (acre)', en: 'Acre (acre)' }, factor: 4046.856 },
                        hectare: { name: { zh: '公顷 (ha)', en: 'Hectare (ha)' }, factor: 10000 },
                    }
                },
                volume: {
                    name: { zh: '体积/容积', en: 'Volume' },
                    baseUnit: 'cubic_meter',
                    list: {
                        cubic_meter: { name: { zh: '立方米 (m³)', en: 'Cubic meter (m³)' }, factor: 1 },
                        liter: { name: { zh: '升 (L)', en: 'Liter (L)' }, factor: 0.001 },
                        milliliter: { name: { zh: '毫升 (mL)', en: 'Milliliter (mL)' }, factor: 0.000001 },
                        cubic_foot: { name: { zh: '立方英尺 (ft³)', en: 'Cubic foot (ft³)' }, factor: 0.02831685 },
                        cubic_inch: { name: { zh: '立方英寸 (in³)', en: 'Cubic inch (in³)' }, factor: 0.0000163871 },
                        gallon_us: { name: { zh: '美制加仑 (gal)', en: 'US Gallon (gal)' }, factor: 0.00378541 },
                        gallon_uk: { name: { zh: '英制加仑 (gal)', en: 'UK Gallon (gal)' }, factor: 0.00454609 },
                    }
                },
                constants: {
                    name: { zh: '常用常数', en: 'Common Constants' },
                    isConstant: true, // 特殊标记
                    list: {
                        pi: { name: { zh: '圆周率 (π)', en: 'Pi (π)' }, value: Math.PI },
                        e: { name: { zh: '自然常数 (e)', en: 'Euler\'s Number (e)' }, value: Math.E },
                        g_const: { name: { zh: '标准重力 (g)', en: 'Standard Gravity (g)' }, value: 9.80665 },
                        c_light: { name: { zh: '光速 (c)', en: 'Speed of Light (c)' }, value: 299792458 },
                        h_planck: { name: { zh: '普朗克常数 (h)', en: 'Planck Constant (h)' }, value: 6.62607015e-34 },
                        k_boltzmann: { name: { zh: '玻尔兹曼常数 (k)', en: 'Boltzmann Constant (k)' }, value: 1.380649e-23 },
                        n_avogadro: { name: { zh: '阿伏伽德罗常数 (N_A)', en: 'Avogadro Constant (N_A)' }, value: 6.02214076e23 },
                        g_grav: { name: { zh: '万有引力常数 (G)', en: 'Gravitational Constant (G)' }, value: 6.67430e-11 },
                        r_gas: { name: { zh: '摩尔气体常数 (R)', en: 'Molar Gas Constant (R)' }, value: 8.314462618 }
                    }
                },
            };

            // --- 3. 获取 DOM 元素 ---
            const mainTitle = document.getElementById('mainTitle');
            const categoryLabel = document.getElementById('categoryLabel');
            const inputLabel = document.getElementById('inputLabel');
            const resultLabel = document.getElementById('resultLabel');
            const versionLabel = document.getElementById('versionLabel');
            const authorLabel = document.getElementById('authorLabel'); 
            const versionNumber = document.getElementById('versionNumber');
            const langToggleButton = document.getElementById('langToggleButton');
            
            const categorySelect = document.getElementById('categorySelect');
            const inputValue = document.getElementById('inputValue');
            const fromUnitSelect = document.getElementById('fromUnitSelect');
            const toUnitSelect = document.getElementById('toUnitSelect');
            const resultValue = document.getElementById('resultValue');
            const swapButton = document.getElementById('swapButton'); 

            // --- 4. 核心功能函数 ---

            /**
             * 填充类别下拉框
             */
            function populateCategories() {
                categorySelect.innerHTML = '';
                // 按制冷行业常用 -> 其他的顺序排序
                const categoryOrder = [
                    'pressure', 'power', 'energy', 'volumetric_flow', 'mass_flow', 
                    'density', 'specific_heat', 'thermal_conductivity', 'dynamic_viscosity', 'kinematic_viscosity', 
                    'speed', 'acceleration', 
                    'temperature', 'length', 'mass', 'area', 'volume',
                    'constants' 
                ];
                
                categoryOrder.forEach(key => {
                    if (units[key]) {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = units[key].name[currentLang]; // 使用当前语言
                        categorySelect.appendChild(option);
                    }
                });

                // 添加其他未在排序列表中的类别
                Object.keys(units).forEach(key => {
                    if (!categoryOrder.includes(key)) {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = units[key].name[currentLang]; // 使用当前语言
                        categorySelect.appendChild(option);
                    }
                });
            }

            /**
             * 根据所选类别更新单位下拉框
             */
            function updateUnitDropdowns() {
                const categoryKey = categorySelect.value;
                if (!categoryKey || !units[categoryKey]) return; // 增加保护
                
                const category = units[categoryKey];
                const unitList = category.list;

                // 清空旧选项
                fromUnitSelect.innerHTML = '';
                toUnitSelect.innerHTML = '';

                if (category.isConstant) {
                    // --- 常数显示模式 ---
                    inputValue.style.display = 'none';
                    toUnitSelect.style.display = 'none';
                    swapButton.style.display = 'none';
                    
                    inputLabel.textContent = translations[currentLang].selectConstant;
                    resultLabel.textContent = translations[currentLang].constantValue;

                    Object.keys(unitList).forEach(key => {
                        const name = unitList[key].name[currentLang];
                        const fromOption = document.createElement('option');
                        fromOption.value = key;
                        fromOption.textContent = name;
                        fromUnitSelect.appendChild(fromOption);
                    });
                    
                    fromUnitSelect.selectedIndex = 0;
                    showConstantValue();

                } else {
                    // --- 单位换算模式 ---
                    inputValue.style.display = 'block';
                    toUnitSelect.style.display = 'block';
                    // swapButton 是 flex 布局
                    swapButton.style.display = 'flex'; 
                    
                    inputLabel.textContent = translations[currentLang].input;
                    resultLabel.textContent = translations[currentLang].result;

                    // 填充新选项
                    Object.keys(unitList).forEach(key => {
                        const name = unitList[key].name[currentLang]; // 使用当前语言
                        
                        const fromOption = document.createElement('option');
                        fromOption.value = key;
                        fromOption.textContent = name;
                        fromUnitSelect.appendChild(fromOption);
                        
                        const toOption = document.createElement('option');
                        toOption.value = key;
                        toOption.textContent = name;
                        toUnitSelect.appendChild(toOption);
                    });

                    // 设置默认选项
                    const options = Array.from(fromUnitSelect.options).map(o => o.value);

                    if (categoryKey === 'pressure' && options.includes('psi') && options.includes('bar')) {
                        fromUnitSelect.value = 'psi';
                        toUnitSelect.value = 'bar';
                    } else if (categoryKey === 'power' && options.includes('ton_refrigeration') && options.includes('kilowatt')) {
                        fromUnitSelect.value = 'ton_refrigeration';
                        toUnitSelect.value = 'kilowatt';
                    } else if (categoryKey === 'energy' && options.includes('kcal') && options.includes('kwh')) {
                        fromUnitSelect.value = 'kcal';
                        toUnitSelect.value = 'kwh';
                    } else if (categoryKey === 'volumetric_flow' && options.includes('cfm') && options.includes('m3_hr')) {
                        fromUnitSelect.value = 'cfm';
                        toUnitSelect.value = 'm3_hr';
                    } else if (options.length > 1) {
                        fromUnitSelect.selectedIndex = 0;
                        toUnitSelect.selectedIndex = 1;
                    } else if (options.length > 0) {
                        fromUnitSelect.selectedIndex = 0;
                        toUnitSelect.selectedIndex = 0;
                    }
                    
                    // 更新后立即执行一次换算
                    convert();
                }
            }

            /**
             * (新增) 显示常数值
             */
            function showConstantValue() {
                const categoryKey = categorySelect.value;
                const constantKey = fromUnitSelect.value;

                if (!categoryKey || !constantKey || !units[categoryKey] || !units[categoryKey].isConstant) {
                    resultValue.textContent = '-';
                    return;
                }
                
                const value = units[categoryKey].list[constantKey].value;
                resultValue.textContent = formatNumber(value);
            }

            /**
             * 执行换算
             */
            function convert() {
                const value = parseFloat(inputValue.value);
                const categoryKey = categorySelect.value;
                const fromUnitKey = fromUnitSelect.value;
                const toUnitKey = toUnitSelect.value;

                // 如果是常数类别，则不执行
                if (units[categoryKey] && units[categoryKey].isConstant) {
                    showConstantValue(); // 确保常数值正确显示
                    return;
                }

                if (isNaN(value) || !categoryKey || !fromUnitKey || !toUnitKey) {
                    resultValue.textContent = '-';
                    return;
                }

                let result;

                // 特殊处理：温度
                if (categoryKey === 'temperature') {
                    result = convertTemperature(value, fromUnitKey, toUnitKey);
                } 
                // 标准换算：通过基础单位
                else {
                    const category = units[categoryKey];
                    const fromFactor = category.list[fromUnitKey].factor;
                    const toFactor = category.list[toUnitKey].factor;
                    
                    // 1. 转换到基础单位
                    const valueInBase = value * fromFactor;
                    // 2. 从基础单位转换到目标单位
                    result = valueInBase / toFactor;
                }

                // 格式化输出，保留合理的小数位数
                resultValue.textContent = formatNumber(result);
            }

            /**
             * 温度换算（特殊逻辑）
             */
            function convertTemperature(value, from, to) {
                if (from === to) return value;

                let celsiusValue;

                // 1. 全部转换到摄氏度 (Celsius)
                switch (from) {
                    case 'celsius':
                        celsiusValue = value;
                        break;
                    case 'fahrenheit':
                        celsiusValue = (value - 32) * 5 / 9;
                        break;
                    case 'kelvin':
                        celsiusValue = value - 273.15;
                        break;
                }

                // 2. 从摄氏度转换到目标单位
                switch (to) {
                    case 'celsius':
                        return celsiusValue;
                    case 'fahrenheit':
                        return (celsiusValue * 9 / 5) + 32;
                    case 'kelvin':
                        return celsiusValue + 273.15;
                }
            }

Storage
            /**
             * 格式化数字显示，避免过多小数
             */
            function formatNumber(num) {
                if (num === 0) return 0;
                
                // 使用科学计数法处理极大或极小的数
                if (Math.abs(num) > 1e10 || (Math.abs(num) < 1e-6 && Math.abs(num) > 0)) {
                    return num.toExponential(6);
                }
                
                // 对于普通数字，保留最多15位有效数字 (常数需要更高精度)
                let formatted = num.toPrecision(15);
                
                // 去除末尾不必要的0和小数点
                if (formatted.includes('.')) {
                    formatted = formatted.replace(/0+$/, '').replace(/\.$/, '');
                }
                
                return formatted;
            }

            /**
             * 交换 "从" 和 "至" 的单位
             */
            function swapUnits() {
                const categoryKey = categorySelect.value;
                // 常数类别下不执行交换
                if (units[categoryKey] && units[categoryKey].isConstant) return;

                const fromValue = fromUnitSelect.value;
                const toValue = toUnitSelect.value;
                
                fromUnitSelect.value = toValue;
                toUnitSelect.value = fromValue;
                
                // 交换后立即重新计算
                convert();
            }

            /**
             * 更新界面语言
             */
            function updateLanguage(lang) {
                currentLang = lang;
                document.documentElement.lang = lang;
                
                // 1. 更新静态文本
                const t = translations[lang];
                mainTitle.textContent = t.title;
                categoryLabel.textContent = t.category;
                // inputLabel 和 resultLabel 将在 updateUnitDropdowns 中设置
                versionLabel.textContent = t.version;
                authorLabel.textContent = t.author; 
                versionNumber.textContent = version;
                langToggleButton.textContent = t.langToggle;
                
                // 2. 保存当前下拉框选项
                const oldCategory = categorySelect.value;
                const oldFrom = fromUnitSelect.value;
                const oldTo = toUnitSelect.value;

                // 3. 重新填充下拉框
                populateCategories();
                // 恢复选择（如果类别仍然存在）
                if (Array.from(categorySelect.options).some(o => o.value === oldCategory)) {
                    categorySelect.value = oldCategory;
                }

                updateUnitDropdowns(); // <-- 此函数会根据类别设置正确的标签和模式

                // 恢复选择（如果单位仍然存在）
                if (Array.from(fromUnitSelect.options).some(o => o.value === oldFrom)) {
                    fromUnitSelect.value = oldFrom;
                }
                if (Array.from(toUnitSelect.options).some(o => o.value === oldTo)) {
                    toUnitSelect.value = oldTo;
                }
                
                // 4. 确保换算同步 (在恢复选项后)
                const category = units[categorySelect.value];
                if (category && category.isConstant) {
                    showConstantValue();
                } else {
                    convert();
                }
            }

            // --- 5. 绑定事件监听器 ---
            
            // 切换语言
            langToggleButton.addEventListener('click', () => {
                const newLang = currentLang === 'zh' ? 'en' : 'zh';
                updateLanguage(newLang);
            });

            // 交换单位
            swapButton.addEventListener('click', swapUnits); 

            // 换算逻辑
            categorySelect.addEventListener('change', updateUnitDropdowns);
            inputValue.addEventListener('input', convert);
            
            // fromUnitSelect 现在需要根据模式调用不同函数
            fromUnitSelect.addEventListener('change', () => {
                const categoryKey = categorySelect.value;
                if (units[categoryKey] && units[categoryKey].isConstant) {
                    showConstantValue();
                } else {
                    convert();
                }
            });
            
            toUnitSelect.addEventListener('change', convert);

            // --- 6. 初始化 ---
            updateLanguage(currentLang); // 初始加载
            inputValue.value = 1; // 默认输入1，方便查看
            
            // 初始加载时，根据类别决定调用 convert 还是 showConstantValue
            const initialCategory = units[categorySelect.value];
            if (initialCategory && initialCategory.isConstant) {
                showConstantValue();
            } else {
                convert();
            }
        });
    </script>
</body>
</html>

